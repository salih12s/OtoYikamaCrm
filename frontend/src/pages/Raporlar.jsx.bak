import React, { useState, useEffect, useCallback } from 'react';
import {
  Box,
  Typography,
  Card,
  CardContent,
  Grid,
  Tab,
  Tabs,
  Button,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  TextField,
  MenuItem,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  Chip,
  IconButton,
  Alert,
} from '@mui/material';
import {
  Assessment as AssessmentIcon,
  Add as AddIcon,
  Edit as EditIcon,
  Delete as DeleteIcon,
  TrendingUp as TrendingUpIcon,
  TrendingDown as TrendingDownIcon,
} from '@mui/icons-material';
import { raporlar, giderler, istatistikler } from '../api';

function TabPanel({ children, value, index }) {
  return (
    <div hidden={value !== index}>
      {value === index && <Box sx={{ pt: 3 }}>{children}</Box>}
    </div>
  );
}

export default function Raporlar() {
  const [tabValue, setTabValue] = useState(0);
  const [gunlukData, setGunlukData] = useState(null);
  const [aylikData, setAylikData] = useState(null);
  const [haftalikData, setHaftalikData] = useState([]);
  const [grafikData, setGrafikData] = useState([]);
  const [giderData, setGiderData] = useState([]);
  const [giderOzet, setGiderOzet] = useState([]);
  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
  const [loading, setLoading] = useState(false);
  
  // Gider dialog
  const [giderDialogOpen, setGiderDialogOpen] = useState(false);
  const [editingGider, setEditingGider] = useState(null);
  const [giderForm, setGiderForm] = useState({
    tarih: new Date().toISOString().split('T')[0],
    kategori: 'Elektrik',
    aciklama: '',
    tutar: '',
  });

  const loadReports = useCallback(async () => {
    try {
      setLoading(true);
      switch (tabValue) {
        case 0: // GÃ¼nlÃ¼k Rapor
          const gunluk = await raporlar.gunluk(selectedDate);
          setGunlukData(gunluk.data);
          const dashboard = await raporlar.dashboard();
          setAylikData(dashboard.data.bu_ay);
          break;
        case 1: // HaftalÄ±k Rapor
          const haftalik = await raporlar.haftalik();
          setHaftalikData(haftalik.data);
          break;
        case 2: // Giderler
          const giderlerRes = await giderler.getAll();
          setGiderData(giderlerRes.data);
          const ozetRes = await giderler.getOzet();
          setGiderOzet(ozetRes.data);
          break;
        case 3: // AylÄ±k Grafik
          const grafikRes = await istatistikler.aylik();
          setGrafikData(grafikRes.data.grafik || []);
          break;
        default:
          break;
      }
    } catch (error) {
      console.error('Rapor yÃ¼klenirken hata:', error);
    } finally {
      setLoading(false);
    }
  }, [tabValue, selectedDate]);

  useEffect(() => {
    loadReports();
  }, [loadReports]);

  const handleGiderDialogOpen = (gider = null) => {
    if (gider) {
      setEditingGider(gider);
      setGiderForm({
        tarih: gider.tarih.split('T')[0],
        kategori: gider.kategori,
        aciklama: gider.aciklama || '',
        tutar: gider.tutar,
      });
    } else {
      setEditingGider(null);
      setGiderForm({
        tarih: new Date().toISOString().split('T')[0],
        kategori: 'Elektrik',
        aciklama: '',
        tutar: '',
      });
    }
    setGiderDialogOpen(true);
  };

  const handleGiderSubmit = async () => {
    try {
      if (editingGider) {
        await giderler.update(editingGider.id, giderForm);
      } else {
        await giderler.create(giderForm);
      }
      setGiderDialogOpen(false);
      loadReports();
    } catch (error) {
      console.error('Gider kaydedilirken hata:', error);
    }
  };

  const handleGiderDelete = async (id) => {
    if (window.confirm('Bu gideri silmek istediÄŸinize emin misiniz?')) {
      try {
        await giderler.delete(id);
        loadReports();
      } catch (error) {
        console.error('Gider silinirken hata:', error);
      }
    }
  };

  return (
    <Box>
      <Typography variant="h5" fontWeight="bold" gutterBottom sx={{ mb: 3, display: 'flex', alignItems: 'center', gap: 1 }}>
        <AssessmentIcon /> Raporlar
      </Typography>

      <Tabs 
        value={tabValue} 
        onChange={(e, newValue) => setTabValue(newValue)}
        variant="fullWidth"
        sx={{ mb: 3 }}
      >
        <Tab label="GÃ¼nlÃ¼k" />
        <Tab label="HaftalÄ±k" />
        <Tab label="Giderler" />
        <Tab label="AylÄ±k Grafik" />
      </Tabs>

      {/* GÃ¼nlÃ¼k Rapor */}
      <TabPanel value={tabValue} index={0}>
        <TextField
          type="date"
          label="Tarih SeÃ§in"
          value={selectedDate}
          onChange={(e) => setSelectedDate(e.target.value)}
          fullWidth
          sx={{ mb: 3 }}
          InputLabelProps={{ shrink: true }}
        />

        {gunlukData && aylikData && (
          <>
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12}>
                <Card sx={{ 
                  background: 'linear-gradient(135deg, #161616 0%, #FFC107 100%)', 
                  border: '4px solid #FFC107',
                  boxShadow: '0 4px 12px rgba(59, 130, 246, 0.4)'
                }}>
                  <CardContent>
                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                      <TrendingUpIcon sx={{ color: '#fff', fontSize: 32 }} />
                      <Typography variant="h6" fontWeight="600" color="#fff">Bu Ayki Gelir</Typography>
                    </Box>
                    <Typography variant="h3" fontWeight="bold" color="#fff">
                      â‚º{parseFloat(aylikData.gelir || 0).toFixed(2)}
                    </Typography>
                    <Typography variant="body1" color="rgba(255,255,255,0.9)">{aylikData.islem} iÅŸlem</Typography>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12}>
                <Card sx={{ 
                  background: 'linear-gradient(135deg, #161616 0%, #FFC107 100%)', 
                  border: '4px solid #FFC107',
                  boxShadow: '0 4px 12px rgba(16, 185, 129, 0.4)'
                }}>
                  <CardContent>
                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                      <TrendingUpIcon sx={{ color: '#fff', fontSize: 32 }} />
                      <Typography variant="h6" fontWeight="600" color="#fff">GÃ¼nlÃ¼k Gelir</Typography>
                    </Box>
                    <Typography variant="h3" fontWeight="bold" color="#fff">
                      â‚º{parseFloat(gunlukData.toplam_gelir || 0).toFixed(2)}
                    </Typography>
                    <Typography variant="body1" color="rgba(255,255,255,0.9)">{gunlukData.toplam_islem} iÅŸlem</Typography>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12}>
                <Card sx={{ 
                  background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', 
                  border: '4px solid #ef4444',
                  boxShadow: '0 4px 12px rgba(239, 68, 68, 0.4)'
                }}>
                  <CardContent>
                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                      <TrendingDownIcon sx={{ color: '#fff', fontSize: 32 }} />
                      <Typography variant="h6" fontWeight="600" color="#fff">Tahsil Edilmedi</Typography>
                    </Box>
                    <Typography variant="h3" fontWeight="bold" color="#fff">
                      â‚º{parseFloat(gunlukData.tahsil_edilmedi || 0).toFixed(2)}
                    </Typography>
                    <Typography variant="body1" color="rgba(255,255,255,0.9)">BorÃ§</Typography>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>

            {gunlukData.odeme_yontemleri && gunlukData.odeme_yontemleri.length > 0 && (
              <Card>
                <CardContent>
                  <Typography variant="h6" gutterBottom>Ã–deme YÃ¶ntemleri</Typography>
                  <Grid container spacing={2}>
                    {gunlukData.odeme_yontemleri.map((odeme, idx) => (
                      <Grid item xs={6} key={idx}>
                        <Card sx={{ 
                          background: 'linear-gradient(135deg, #161616 0%, #FFC107 100%)', 
                          border: '3px solid #FFC107',
                          boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)'
                        }}>
                          <CardContent>
                            <Typography variant="body1" fontWeight="600" color="#fff">{odeme.odeme_yontemi}</Typography>
                            <Typography variant="h4" fontWeight="bold" color="#fff">
                              â‚º{parseFloat(odeme.toplam).toFixed(2)}
                            </Typography>
                            <Typography variant="body2" color="rgba(255,255,255,0.9)">{odeme.adet} iÅŸlem</Typography>
                          </CardContent>
                        </Card>
                      </Grid>
                    ))}
                  </Grid>
                </CardContent>
              </Card>
            )}
          </>
        )}
      </TabPanel>

      {/* HaftalÄ±k Rapor */}
      <TabPanel value={tabValue} index={1}>
        <Box>
          <Typography variant="h6" fontWeight="bold" sx={{ mb: 3, color: '#FFC107' }}>
            ðŸ“… Son 7 GÃ¼nlÃ¼k Gelir
          </Typography>
          {haftalikData.length === 0 ? (
            <Alert severity="info">HenÃ¼z veri bulunmuyor.</Alert>
          ) : (
            <TableContainer 
              component={Paper} 
              sx={{ 
                borderRadius: 3,
                boxShadow: '0 8px 32px rgba(255, 193, 7, 0.2)',
                border: '1px solid rgba(255, 193, 7, 0.3)'
              }}
            >
              <Table>
                <TableHead>
                  <TableRow sx={{ background: 'linear-gradient(135deg, #161616 0%, #2d2d2d 100%)' }}>
                    <TableCell sx={{ color: '#FFC107', fontWeight: 'bold', fontSize: '1rem' }}>Tarih</TableCell>
                    <TableCell align="right" sx={{ color: '#FFC107', fontWeight: 'bold', fontSize: '1rem' }}>Ä°ÅŸlem</TableCell>
                    <TableCell align="right" sx={{ color: '#FFC107', fontWeight: 'bold', fontSize: '1rem' }}>Gelir</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {haftalikData.map((gun, index) => (
                    <TableRow 
                      key={index}
                      sx={{
                        '&:hover': {
                          background: 'rgba(255, 193, 7, 0.05)'
                        }
                      }}
                    >
                      <TableCell sx={{ fontSize: '0.95rem' }}>
                        {new Date(gun.gun).toLocaleDateString('tr-TR', { weekday: 'short', day: 'numeric', month: 'short' })}
                      </TableCell>
                      <TableCell align="right">
                        <Chip 
                          label={gun.toplam_islem} 
                          size="small"
                          sx={{ 
                            background: '#06B6D4',
                            color: 'white',
                            fontWeight: '600'
                          }}
                        />
                      </TableCell>
                      <TableCell align="right">
                        <Typography fontWeight="bold" color="#10B981" fontSize="1.1rem">
                          â‚º{parseFloat(gun.toplam_gelir).toFixed(2)}
                        </Typography>
                      </TableCell>
                      </TableRow>
                    ))}
                    {haftalikData.length > 0 && (
                      <TableRow sx={{ bgcolor: 'background.default' }}>
                        <TableCell><strong>TOPLAM</strong></TableCell>
                        <TableCell align="right">
                          <Chip 
                            label={haftalikData.reduce((sum, g) => sum + parseInt(g.toplam_islem), 0)} 
                            color="primary" 
                          />
                        </TableCell>
                        <TableCell align="right">
                          <Typography fontWeight="bold" color="#FFC107" variant="h6">
                            â‚º{haftalikData.reduce((sum, g) => sum + parseFloat(g.toplam_gelir), 0).toFixed(2)}
                          </Typography>
                        </TableCell>
                      </TableRow>
                    )}
                  </TableBody>
                </Table>
              </TableContainer>
            )}
          </CardContent>
        </Card>
      </TabPanel>

      {/* Giderler */}
      <TabPanel value={tabValue} index={2}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
          <Typography variant="h6">Gider YÃ¶netimi</Typography>
          <Button
            variant="contained"
            color="primary"
            startIcon={<AddIcon />}
            onClick={() => handleGiderDialogOpen()}
          >
            Yeni Gider
          </Button>
        </Box>

        {/* Gider Ã–zeti */}
        {giderOzet.length > 0 && (
          <Grid container spacing={2} sx={{ mb: 3 }}>
            {giderOzet.map((ozet, idx) => (
              <Grid item xs={6} key={idx}>
                <Card sx={{ 
                  background: 'linear-gradient(135deg, #161616 0%, #FFC107 100%)', 
                  border: '3px solid #FFC107',
                  boxShadow: '0 4px 12px rgba(245, 158, 11, 0.3)'
                }}>
                  <CardContent>
                    <Typography variant="body1" fontWeight="600" color="#fff">{ozet.kategori}</Typography>
                    <Typography variant="h4" fontWeight="bold" color="#fff">
                      â‚º{parseFloat(ozet.toplam).toFixed(2)}
                    </Typography>
                    <Typography variant="body2" color="rgba(255,255,255,0.9)">{ozet.adet} kayÄ±t</Typography>
                  </CardContent>
                </Card>
              </Grid>
            ))}
            <Grid item xs={12}>
              <Card sx={{ 
                background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', 
                border: '4px solid #ef4444',
                boxShadow: '0 4px 12px rgba(239, 68, 68, 0.4)'
              }}>
                <CardContent>
                  <Typography variant="h6" fontWeight="600" color="#fff">TOPLAM GÄ°DER</Typography>
                  <Typography variant="h3" fontWeight="bold" color="#fff">
                    â‚º{giderOzet.reduce((sum, g) => sum + parseFloat(g.toplam), 0).toFixed(2)}
                  </Typography>
                </CardContent>
              </Card>
            </Grid>
          </Grid>
        )}

        {/* Gider Listesi */}
        <Card>
          <CardContent>
            {giderData.length === 0 ? (
              <Alert severity="info">HenÃ¼z gider kaydÄ± bulunmuyor. "Yeni Gider" butonuna tÄ±klayarak ekleyebilirsiniz.</Alert>
            ) : (
              <TableContainer component={Paper}>
                <Table>
                  <TableHead>
                    <TableRow>
                      <TableCell><strong>Tarih</strong></TableCell>
                      <TableCell><strong>Kategori</strong></TableCell>
                      <TableCell><strong>AÃ§Ä±klama</strong></TableCell>
                      <TableCell align="right"><strong>Tutar</strong></TableCell>
                      <TableCell align="right"><strong>Ä°ÅŸlem</strong></TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {giderData.map((gider) => (
                      <TableRow key={gider.id} hover>
                        <TableCell>{new Date(gider.tarih).toLocaleDateString('tr-TR')}</TableCell>
                        <TableCell>
                          <Chip label={gider.kategori} size="small" color="warning" />
                        </TableCell>
                        <TableCell>{gider.aciklama || '-'}</TableCell>
                        <TableCell align="right">
                          <Typography fontWeight="bold" color="#ef4444">
                            â‚º{parseFloat(gider.tutar).toFixed(2)}
                          </Typography>
                        </TableCell>
                        <TableCell align="right">
                          <IconButton size="small" color="primary" onClick={() => handleGiderDialogOpen(gider)}>
                            <EditIcon fontSize="small" />
                          </IconButton>
                          <IconButton size="small" color="error" onClick={() => handleGiderDelete(gider.id)}>
                            <DeleteIcon fontSize="small" />
                          </IconButton>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            )}
          </CardContent>
        </Card>
      </TabPanel>

      {/* Gider Ekleme/DÃ¼zenleme Dialog */}
      <Dialog open={giderDialogOpen} onClose={() => setGiderDialogOpen(false)} maxWidth="sm" fullWidth>
        <DialogTitle>{editingGider ? 'Gider DÃ¼zenle' : 'Yeni Gider Ekle'}</DialogTitle>
        <DialogContent>
          <Grid container spacing={2} sx={{ mt: 1 }}>
            <Grid item xs={12}>
              <TextField
                fullWidth
                type="date"
                label="Tarih"
                value={giderForm.tarih}
                onChange={(e) => setGiderForm({ ...giderForm, tarih: e.target.value })}
                InputLabelProps={{ shrink: true }}
              />
            </Grid>
            <Grid item xs={12}>
              <TextField
                fullWidth
                select
                label="Kategori"
                value={giderForm.kategori}
                onChange={(e) => setGiderForm({ ...giderForm, kategori: e.target.value })}
              >
                <MenuItem value="Elektrik">Elektrik</MenuItem>
                <MenuItem value="Su">Su</MenuItem>
                <MenuItem value="DoÄŸalgaz">DoÄŸalgaz</MenuItem>
                <MenuItem value="Kira">Kira</MenuItem>
                <MenuItem value="MaaÅŸ">MaaÅŸ</MenuItem>
                <MenuItem value="Temizlik Malzemeleri">Temizlik Malzemeleri</MenuItem>
                <MenuItem value="BakÄ±m-OnarÄ±m">BakÄ±m-OnarÄ±m</MenuItem>
                <MenuItem value="DiÄŸer">DiÄŸer</MenuItem>
              </TextField>
            </Grid>
            <Grid item xs={12}>
              <TextField
                fullWidth
                label="AÃ§Ä±klama"
                value={giderForm.aciklama}
                onChange={(e) => setGiderForm({ ...giderForm, aciklama: e.target.value })}
                multiline
                rows={2}
                placeholder="Gider aÃ§Ä±klamasÄ± (opsiyonel)"
              />
            </Grid>
            <Grid item xs={12}>
              <TextField
                fullWidth
                type="number"
                label="Tutar (â‚º)"
                value={giderForm.tutar}
                onChange={(e) => setGiderForm({ ...giderForm, tutar: e.target.value })}
                required
              />
            </Grid>
          </Grid>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setGiderDialogOpen(false)}>Ä°ptal</Button>
          <Button onClick={handleGiderSubmit} variant="contained" color="primary">
            {editingGider ? 'GÃ¼ncelle' : 'Ekle'}
          </Button>
        </DialogActions>
      </Dialog>

      {/* AylÄ±k Grafik Tab */}
      <TabPanel value={tabValue} index={3}>
        <Card>
          <CardContent>
            <Typography variant="h6" fontWeight="bold" gutterBottom sx={{ mb: 3 }}>
              ðŸ“Š Son 12 Ay KazanÃ§ GrafiÄŸi
            </Typography>

            {grafikData.length === 0 ? (
              <Alert severity="info">HenÃ¼z grafik verisi bulunmuyor.</Alert>
            ) : (
              <Box>
                {/* Grafik Ã–zet KartlarÄ± */}
                <Grid container spacing={2} sx={{ mb: 4 }}>
                  <Grid item xs={12} sm={4}>
                    <Card sx={{ 
                      background: '#10B981',
                      color: 'white',
                      borderRadius: 3,
                      boxShadow: '0 8px 24px rgba(16, 185, 129, 0.4)'
                    }}>
                      <CardContent sx={{ textAlign: 'center', py: 3 }}>
                        <Typography variant="h3" fontWeight="bold" sx={{ mb: 1 }}>
                          â‚º{grafikData.reduce((sum, item) => sum + parseFloat(item.kazanc || 0), 0).toFixed(0)}
                        </Typography>
                        <Typography variant="body1" fontWeight="500">ðŸ’° Toplam KazanÃ§</Typography>
                      </CardContent>
                    </Card>
                  </Grid>
                  <Grid item xs={12} sm={4}>
                    <Card sx={{ 
                      background: '#D4A927',
                      color: 'white',
                      borderRadius: 3,
                      boxShadow: '0 8px 24px rgba(212, 169, 39, 0.4)'
                    }}>
                      <CardContent sx={{ textAlign: 'center', py: 3 }}>
                        <Typography variant="h3" fontWeight="bold" sx={{ mb: 1 }}>
                          {grafikData.reduce((sum, item) => sum + parseInt(item.musteri_sayisi || 0), 0)}
                        </Typography>
                        <Typography variant="body1" fontWeight="500">ðŸ‘¥ Toplam MÃ¼ÅŸteri</Typography>
                      </CardContent>
                    </Card>
                  </Grid>
                  <Grid item xs={12} sm={4}>
                    <Card sx={{ 
                      background: '#06B6D4',
                      color: 'white',
                      borderRadius: 3,
                      boxShadow: '0 8px 24px rgba(6, 182, 212, 0.4)'
                    }}>
                      <CardContent sx={{ textAlign: 'center', py: 3 }}>
                        <Typography variant="h3" fontWeight="bold" sx={{ mb: 1 }}>
                          â‚º{(grafikData.reduce((sum, item) => sum + parseFloat(item.kazanc || 0), 0) / grafikData.length).toFixed(0)}
                        </Typography>
                        <Typography variant="body1" fontWeight="500">ðŸ“Š AylÄ±k Ortalama</Typography>
                      </CardContent>
                    </Card>
                  </Grid>
                </Grid>

                {/* GeliÅŸmiÅŸ Ã‡ubuk Grafik */}
                <Card sx={{ 
                  mb: 3,
                  borderRadius: 3,
                  background: 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)',
                  border: '2px solid #FFC107',
                  boxShadow: '0 8px 32px rgba(255, 193, 7, 0.3)'
                }}>
                  <CardContent sx={{ p: 3 }}>
                    <Typography variant="h6" fontWeight="bold" color="#FFC107" sx={{ mb: 3, textAlign: 'center' }}>
                      ðŸ“ˆ AylÄ±k KazanÃ§ Trendi
                    </Typography>
                    <Box sx={{ 
                      display: 'flex', 
                      alignItems: 'flex-end', 
                      justifyContent: 'space-around',
                      gap: 0.5, 
                      height: 320,
                      px: { xs: 1, sm: 2 },
                      pb: 2,
                      position: 'relative',
                      '&::before': {
                        content: '""',
                        position: 'absolute',
                        bottom: 0,
                        left: 0,
                        right: 0,
                        height: '1px',
                        background: 'rgba(255, 193, 7, 0.3)'
                      }
                    }}>
                      {grafikData.map((item, index) => {
                        const maxKazanc = Math.max(...grafikData.map(d => parseFloat(d.kazanc || 0)));
                        const height = maxKazanc > 0 ? (parseFloat(item.kazanc) / maxKazanc) * 100 : 0;
                        const ayIsmi = new Date(item.ay + '-01').toLocaleDateString('tr-TR', { month: 'short' });
                        const kazanc = parseFloat(item.kazanc);
                        
                        return (
                          <Box 
                            key={index}
                            sx={{ 
                              flex: 1,
                              maxWidth: '60px',
                              display: 'flex', 
                              flexDirection: 'column',
                              alignItems: 'center',
                              gap: 1,
                              position: 'relative'
                            }}
                          >
                            {/* Ã‡ubuk */}
                            <Box
                              sx={{
                                width: '100%',
                                height: `${Math.max(height, 2)}%`,
                                minHeight: '20px',
                                background: kazanc > 0 
                                  ? 'linear-gradient(180deg, #FFC107 0%, #D4A927 50%, #FFD54F 100%)'
                                  : 'rgba(255, 193, 7, 0.1)',
                                borderRadius: '8px 8px 0 0',
                                transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                                position: 'relative',
                                cursor: 'pointer',
                                boxShadow: kazanc > 0 ? '0 4px 16px rgba(255, 193, 7, 0.5)' : 'none',
                                '&:hover': {
                                  transform: 'scaleY(1.08) scaleX(1.1)',
                                  boxShadow: '0 8px 24px rgba(255, 193, 7, 0.7)',
                                  '&::after': {
                                    opacity: 1
                                  }
                                },
                                '&::after': {
                                  content: `"â‚º${kazanc.toFixed(0)}"`,
                                  position: 'absolute',
                                  top: -30,
                                  left: '50%',
                                  transform: 'translateX(-50%)',
                                  background: '#161616',
                                  color: '#FFC107',
                                  padding: '4px 8px',
                                  borderRadius: '6px',
                                  fontSize: '0.75rem',
                                  fontWeight: 'bold',
                                  whiteSpace: 'nowrap',
                                  opacity: 0,
                                  transition: 'opacity 0.3s ease',
                                  border: '1px solid #FFC107',
                                  boxShadow: '0 4px 12px rgba(0, 0, 0, 0.5)'
                                }
                              }}
                            />
                            
                            {/* Ay ismi */}
                            <Typography 
                              variant="caption" 
                              sx={{ 
                                fontSize: '0.65rem',
                                fontWeight: '600',
                                color: '#FFC107',
                                textAlign: 'center',
                                textTransform: 'uppercase',
                                letterSpacing: '0.5px'
                              }}
                            >
                              {ayIsmi}
                            </Typography>
                            
                            {/* MÃ¼ÅŸteri sayÄ±sÄ± */}
                            <Typography 
                              variant="caption" 
                              sx={{ 
                                fontSize: '0.6rem',
                                color: 'rgba(255, 193, 7, 0.7)',
                                textAlign: 'center'
                              }}
                            >
                              {item.musteri_sayisi}ðŸ‘¤
                            </Typography>
                          </Box>
                        );
                      })}
                    </Box>
                  </CardContent>
                </Card>

                {/* Detay Tablosu */}
                <TableContainer component={Paper}>
                  <Table size="small">
                    <TableHead>
                      <TableRow sx={{ bgcolor: 'background.default' }}>
                        <TableCell><strong>Ay</strong></TableCell>
                        <TableCell align="right"><strong>KazanÃ§</strong></TableCell>
                        <TableCell align="right"><strong>MÃ¼ÅŸteri</strong></TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {grafikData.map((item, index) => (
                        <TableRow key={index} hover>
                          <TableCell>
                            {new Date(item.ay + '-01').toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' })}
                          </TableCell>
                          <TableCell align="right">
                            <Chip 
                              label={`â‚º${parseFloat(item.kazanc).toFixed(2)}`}
                              color="primary"
                              size="small"
                              sx={{ fontWeight: 'bold' }}
                            />
                          </TableCell>
                          <TableCell align="right">
                            <Chip 
                              label={item.musteri_sayisi}
                              size="small"
                            />
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </Box>
            )}
          </CardContent>
        </Card>
      </TabPanel>
    </Box>
  );
}
